---
phase: 02-public-site
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260211000003_phase2_public_site.sql
  - supabase/seed.sql
  - src/app.css
  - src/app.html
  - src/routes/+page.svelte
  - src/routes/(site)/+layout.svelte
  - src/routes/(site)/+page.svelte
  - src/routes/(site)/about/+page.svelte
  - src/routes/(site)/contact/+page.svelte
  - src/lib/types/database.ts
autonomous: true

must_haves:
  truths:
    - "Anon role can SELECT from ranks, units, and active soldiers"
    - "Enlistments table exists with anon INSERT policy"
    - "Events table exists with anon SELECT policy"
    - "Site route group renders with tactical dark theme at /"
    - "Landing page shows unit identity and enlist CTA"
    - "About page shows unit history and mission"
    - "Contact page shows Discord link"
  artifacts:
    - path: "supabase/migrations/20260211000003_phase2_public_site.sql"
      provides: "enlistments table, events table, anon RLS policies, rank seed data"
      contains: "create table public.enlistments"
    - path: "src/routes/(site)/+layout.svelte"
      provides: "Public site chrome with nav and footer"
      min_lines: 20
    - path: "src/routes/(site)/+page.svelte"
      provides: "Landing page with unit identity and enlist CTA"
      min_lines: 15
    - path: "src/app.css"
      provides: "Tailwind v4 tactical dark theme"
      contains: "@theme"
  key_links:
    - from: "src/routes/(site)/+layout.svelte"
      to: "src/routes/(site)/+page.svelte"
      via: "SvelteKit route group layout rendering"
      pattern: "children"
    - from: "src/app.html"
      to: "src/app.css"
      via: "dark class on html element enables theme"
      pattern: "class=\"dark\""
---

<objective>
Set up the Phase 2 database migration (enlistments table, events table, anon RLS policies, rank seed data), install superforms + zod, create the (site) route group with tactical dark theme, and build the three static/minimal pages: Landing, About, Contact.

Purpose: Establishes all infrastructure that subsequent plans depend on (DB tables, anon policies, dependencies, route group, theme) plus ships the simplest pages immediately.
Output: Working (site) route group with 3 pages, migration applied, superforms + zod installed.
</objective>

<execution_context>
@/home/iancrowder/.claude/get-shit-done/workflows/execute-plan.md
@/home/iancrowder/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-public-site/02-RESEARCH.md
@src/app.css
@src/app.html
@src/routes/+layout.svelte
@src/routes/+page.svelte
@src/hooks.server.ts
@src/lib/supabase/server.ts
@supabase/migrations/20260211000000_initial_schema.sql
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Database migration and dependency installation</name>
  <files>
    supabase/migrations/20260211000003_phase2_public_site.sql
    supabase/seed.sql
    src/lib/types/database.ts
    package.json
  </files>
  <action>
**1. Install superforms and zod:**
```bash
env -u NPM_CONFIG_PREFIX npm install sveltekit-superforms zod
```

**2. Create migration `supabase/migrations/20260211000003_phase2_public_site.sql`:**

Creates the `enlistments` table for SITE-05:
```sql
create table public.enlistments (
  id              uuid primary key default gen_random_uuid(),
  display_name    text not null,
  discord_username text not null,
  age             int,
  timezone        text,
  arma_experience text,
  why_join        text not null,
  referred_by     text,
  status          text not null default 'pending'
                    check (status in ('pending', 'reviewing', 'accepted', 'rejected')),
  submitted_at    timestamptz not null default now(),
  reviewed_at     timestamptz,
  reviewed_by     uuid references auth.users(id) on delete set null,
  notes           text
);
alter table public.enlistments enable row level security;
```

Creates the `events` table for SITE-08:
```sql
create table public.events (
  id          uuid primary key default gen_random_uuid(),
  title       text not null,
  description text,
  event_date  timestamptz not null,
  event_type  text not null check (event_type in ('operation', 'training', 'ftx')),
  status      text not null default 'scheduled'
                check (status in ('scheduled', 'completed', 'cancelled')),
  created_by  uuid references auth.users(id) on delete set null,
  created_at  timestamptz not null default now()
);
alter table public.events enable row level security;
```

Adds anon RLS policies for public reads:
```sql
-- ranks: anon can read (rank chart, ORBAT display)
create policy "Anon can read ranks" on public.ranks for select to anon using (true);

-- units: anon can read (ORBAT)
create policy "Anon can read units" on public.units for select to anon using (true);

-- soldiers: anon can read active soldiers only (partial roster)
create policy "Anon can read active soldiers" on public.soldiers for select to anon using (status = 'active');

-- enlistments: anon can INSERT only (submit application, no reading back)
create policy "Anon can submit enlistments" on public.enlistments for insert to anon with check (true);

-- enlistments: NCO+ can read all
create policy "NCO and above can read enlistments" on public.enlistments for select to authenticated
  using ((select (auth.jwt() ->> 'user_role')::public.app_role) in ('nco', 'command', 'admin'));

-- events: anon can read scheduled events (public events page)
create policy "Anon can read scheduled events" on public.events for select to anon using (status = 'scheduled');

-- events: authenticated can read all events
create policy "Authenticated can read events" on public.events for select to authenticated using (true);

-- events: NCO+ can insert events
create policy "NCO and above can create events" on public.events for insert to authenticated
  with check ((select (auth.jwt() ->> 'user_role')::public.app_role) in ('nco', 'command', 'admin'));
```

**3. Create seed file `supabase/seed.sql`** with US Army SF rank data (23 ranks: E-1 through E-9/CSM, WO1 through CW5, 2LT through COL) using the sort_order values from the research (1-23). Each row: `INSERT INTO public.ranks (name, abbreviation, sort_order) VALUES (...)`.

**4. Push migration to Supabase:**
Extract Supabase access token from `~/.claude/.credentials.json` mcpOAuth entry (sbp_oauth_ token). Link project if needed (`supabase link --project-ref lelwuinxszfwnlquwsho`), then:
```bash
env -u NPM_CONFIG_PREFIX npx supabase db push
```

**5. Seed ranks:**
Run the seed SQL against the remote database using `supabase db execute` or directly via the Supabase SQL editor approach (use the Supabase client URL + service role key from .env).

**6. Regenerate TypeScript types:**
```bash
env -u NPM_CONFIG_PREFIX npx supabase gen types typescript --project-id lelwuinxszfwnlquwsho > src/lib/types/database.ts
```
  </action>
  <verify>
- `env -u NPM_CONFIG_PREFIX npm ls sveltekit-superforms zod` shows both installed
- `env -u NPM_CONFIG_PREFIX npx supabase migration list` shows the new migration as applied
- `src/lib/types/database.ts` contains `enlistments` and `events` table types
- `env -u NPM_CONFIG_PREFIX npm run check` passes
  </verify>
  <done>
Enlistments and events tables exist in remote DB with RLS enabled. Anon policies allow SELECT on ranks/units/active soldiers and INSERT on enlistments. 23 ranks seeded. Superforms and Zod v4 installed. Database types regenerated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Route group, layout, and tactical theme</name>
  <files>
    src/app.css
    src/app.html
    src/routes/+page.svelte
    src/routes/(site)/+layout.svelte
  </files>
  <action>
**1. Update `src/app.html`** — Add `class="dark"` to the `<html>` element. The site is always dark-themed. Also add Google Fonts link for Share Tech Mono in the `<head>`:
```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
```

**2. Update `src/app.css`** — Replace the single `@import "tailwindcss"` with the full tactical theme:
```css
@import "tailwindcss";

@custom-variant dark (&:where(.dark, .dark *));

@theme {
  --color-night: oklch(0.12 0.01 220);
  --color-night-surface: oklch(0.17 0.01 220);
  --color-night-border: oklch(0.25 0.01 220);
  --color-od-green: oklch(0.38 0.07 130);
  --color-od-green-light: oklch(0.52 0.09 130);
  --color-ranger-tan: oklch(0.72 0.08 80);
  --color-ranger-tan-muted: oklch(0.55 0.05 80);
  --color-steel: oklch(0.55 0.02 220);
  --color-alert: oklch(0.62 0.18 25);

  --font-tactical: 'Share Tech Mono', 'Courier New', monospace;
}
```

**3. Delete `src/routes/+page.svelte`** (the placeholder "Welcome to SvelteKit" page). It conflicts with `(site)/+page.svelte` since both map to `/`. The root `+layout.svelte` stays as-is (it just imports app.css and renders children).

**4. Create `src/routes/(site)/+layout.svelte`** — Public site chrome. Contains:
- A `<nav>` with the unit name "ASQN 1st SFOD" as a link to `/`, and navigation links: About, Leadership, ORBAT, Rank Chart, Events, Roster, Contact, and a prominent "ENLIST" CTA link styled with `bg-od-green` and hover effect.
- A `<main>` section that renders `{@render children()}`.
- A `<footer>` with copyright, unit motto/tagline, and a Discord link.
- Use `dark:bg-night` for body background, `dark:text-ranger-tan` for text, `font-tactical` for the nav brand.
- Navigation should be responsive: horizontal links on desktop, a mobile-friendly layout (can use a simple column stack on small screens with a hamburger toggle using Svelte 5 `$state` — keep it simple, just show/hide with a button click).

The layout applies to ALL pages under `(site)/` and gives the site its SOF tactical identity.
  </action>
  <verify>
- `src/routes/+page.svelte` no longer exists (deleted)
- `src/routes/(site)/+layout.svelte` exists with nav containing all page links
- `src/app.css` contains `@theme` block with tactical colors
- `src/app.html` has `class="dark"` on `<html>` element
- `env -u NPM_CONFIG_PREFIX npm run check` passes
  </verify>
  <done>
(site) route group exists with a responsive nav layout, tactical dark theme applied via Tailwind v4 @theme, and the root page conflict is resolved. Navigating to / renders the (site) layout.
  </done>
</task>

<task type="auto">
  <name>Task 3: Landing, About, and Contact pages</name>
  <files>
    src/routes/(site)/+page.svelte
    src/routes/(site)/about/+page.svelte
    src/routes/(site)/contact/+page.svelte
  </files>
  <action>
**1. Create `src/routes/(site)/+page.svelte`** (Landing page — SITE-01):
- Hero section with unit name "ASQN 1st SFOD" in large tactical font, a subtitle like "1st Special Forces Operational Detachment" and a brief tagline about the unit (Arma 3 milsim).
- A brief overview section (2-3 paragraphs) about what the unit is — a realistic Special Forces milsim unit, organized as a squadron with assault and recon troops.
- A prominent "ENLIST NOW" CTA button linking to `/enlist` — styled with `bg-od-green hover:bg-od-green-light text-night` and prominent sizing.
- Quick info cards (3-4): "Organized Structure" (ORBAT link), "Authentic Ranks" (rank chart link), "Active Operations" (events link), "Join Us" (enlist link). Use `dark:bg-night-surface dark:border-night-border` card styling.
- This is a static page — no `+page.server.ts` needed.

**2. Create `src/routes/(site)/about/+page.svelte`** (About page — SITE-02):
- Page title "About ASQN 1st SFOD"
- Unit history section: describe the unit as an Arma 3 milsim unit modeled after real-world US Army Special Forces (Delta Force / 1st SFOD). Include founding context, the unit's mission in the Arma community, and what members can expect.
- Mission section: realistic special operations in the Arma 3 environment, emphasis on teamwork, discipline, and authentic military procedures.
- Unit structure section: Squadron A with three troops (Assault Troop 1, Assault Troop 2, Recce/Sniper Troop) with brief descriptions of each troop's role.
- This is a static page — no `+page.server.ts` needed. All content is hardcoded text.

**3. Create `src/routes/(site)/contact/+page.svelte`** (Contact page — SITE-06):
- Page title "Contact"
- Discord link prominently displayed — use the Discord brand color (`#5865F2`) for the link/button. Link text: "Join our Discord". The actual Discord invite URL can be a placeholder `https://discord.gg/PLACEHOLDER` with a comment to replace it.
- Brief text: "Discord is our primary communication platform. Join the server to connect with leadership, ask questions, or start your enlistment process."
- A secondary link to the enlistment page: "Ready to join? Submit your application."
- This is a static page — no `+page.server.ts` needed.

**Styling for all pages:**
- Use `max-w-4xl mx-auto px-4 py-8` for content containers.
- Section headings: `text-2xl font-bold text-ranger-tan mb-4 font-tactical`.
- Body text: `text-steel leading-relaxed`.
- Links: `text-od-green-light hover:text-ranger-tan transition-colors`.
  </action>
  <verify>
- `env -u NPM_CONFIG_PREFIX npm run check` passes
- `env -u NPM_CONFIG_PREFIX npm run build` succeeds
- All three page files exist and have real content (not placeholders)
  </verify>
  <done>
Landing page renders at / with unit identity, overview, and enlist CTA (SITE-01). About page renders at /about with unit history and mission (SITE-02). Contact page renders at /contact with Discord link (SITE-06). All use the tactical dark theme from the (site) layout.
  </done>
</task>

</tasks>

<verification>
- `env -u NPM_CONFIG_PREFIX npm run build` completes without errors
- `env -u NPM_CONFIG_PREFIX npm run check` reports 0 errors
- Navigate to `/` — landing page with unit identity and enlist CTA renders in tactical dark theme
- Navigate to `/about` — about page with unit history renders
- Navigate to `/contact` — contact page with Discord link renders
- Supabase query `SELECT count(*) FROM ranks` returns 23 (seeded)
- Supabase anon query on `ranks` returns data (not empty array)
</verification>

<success_criteria>
- SITE-01: Landing page with unit identity, overview, and visible enlist CTA
- SITE-02: About page with unit history and mission
- SITE-06: Contact page with Discord link
- Database: enlistments table, events table, anon RLS policies, 23 ranks seeded
- Infrastructure: superforms + zod installed, (site) route group with layout and theme
</success_criteria>

<output>
After completion, create `.planning/phases/02-public-site/02-01-SUMMARY.md`
</output>
