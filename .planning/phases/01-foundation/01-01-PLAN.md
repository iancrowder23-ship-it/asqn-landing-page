---
phase: 01-foundation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.ts
  - svelte.config.js
  - tsconfig.json
  - src/app.css
  - src/routes/+layout.svelte
  - .env.example
  - Dockerfile
  - docker-compose.yml
  - .dockerignore
autonomous: true

must_haves:
  truths:
    - "Running `npm run dev` starts the SvelteKit dev server without errors"
    - "Tailwind v4 utility classes render correctly in the browser (e.g., bg-black text-white)"
    - "The project builds to a standalone Node server via `npm run build`"
    - "Dockerfile builds successfully and the containerized app starts with `docker compose up`"
  artifacts:
    - path: "package.json"
      provides: "All dependencies declared"
      contains: "@supabase/supabase-js"
    - path: "vite.config.ts"
      provides: "Vite config with Tailwind v4 plugin before SvelteKit"
      contains: "tailwindcss()"
    - path: "src/app.css"
      provides: "Tailwind v4 CSS entry point"
      contains: "@import \"tailwindcss\""
    - path: "Dockerfile"
      provides: "Production container build"
      contains: "adapter-node"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "PUBLIC_SUPABASE_URL"
  key_links:
    - from: "vite.config.ts"
      to: "tailwindcss plugin"
      via: "plugins array — tailwindcss() must appear BEFORE sveltekit()"
      pattern: "tailwindcss\\(\\).*sveltekit\\(\\)"
    - from: "src/routes/+layout.svelte"
      to: "src/app.css"
      via: "import '../app.css'"
      pattern: "import.*app\\.css"
    - from: "svelte.config.js"
      to: "adapter-node"
      via: "adapter import"
      pattern: "adapter-node"
---

<objective>
Scaffold the SvelteKit 2 + Svelte 5 project with Tailwind v4, adapter-node, and Docker infrastructure.

Purpose: Every subsequent plan depends on a working SvelteKit project. This establishes the toolchain, dependency versions, and container build that every other plan builds on.
Output: Working SvelteKit dev server, Tailwind v4 rendering, adapter-node build, Docker container.
</objective>

<execution_context>
@/home/iancrowder/.claude/get-shit-done/workflows/execute-plan.md
@/home/iancrowder/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold SvelteKit project with dependencies</name>
  <files>
    package.json
    vite.config.ts
    svelte.config.js
    tsconfig.json
    src/app.css
    src/routes/+layout.svelte
    src/app.d.ts
  </files>
  <action>
    Run the SvelteKit scaffold in the current working directory (not a subdirectory):

    ```bash
    npx sv create . --template minimal --types ts --no-add-ons
    ```

    If the directory is not empty, pass `--force` flag. After scaffolding, install all required dependencies:

    ```bash
    npm install @supabase/supabase-js @supabase/ssr
    npm install tailwindcss @tailwindcss/vite
    npm install -D supabase
    ```

    Then configure Tailwind v4:

    1. Replace the entire contents of `vite.config.ts` with:
    ```typescript
    import { sveltekit } from '@sveltejs/kit/vite'
    import { defineConfig } from 'vite'
    import tailwindcss from '@tailwindcss/vite'

    export default defineConfig({
      plugins: [
        tailwindcss(),   // MUST be first — before sveltekit()
        sveltekit(),
      ],
    })
    ```

    2. Create `src/app.css` with exactly:
    ```css
    @import "tailwindcss";
    ```

    3. Update `src/routes/+layout.svelte` to use Svelte 5 runes syntax and import app.css:
    ```svelte
    <script>
      import '../app.css'
      let { children } = $props()
    </script>

    {@render children()}
    ```

    4. Verify `svelte.config.js` uses adapter-node (it should already be selected during scaffold — if not, update it):
    ```javascript
    import adapter from '@sveltejs/adapter-node'
    import { vitePreprocess } from '@sveltejs/vite-plugin-svelte'

    const config = {
      preprocess: vitePreprocess(),
      kit: {
        adapter: adapter()
      }
    }

    export default config
    ```

    5. Create `src/app.d.ts` with Supabase locals placeholder (to be completed in plan 01-02):
    ```typescript
    // See https://svelte.dev/docs/kit/types#app.d.ts
    declare global {
      namespace App {
        // Locals populated in hooks.server.ts (plan 01-02)
        interface Locals {}
        interface PageData {}
        interface PageState {}
        interface Platform {}
      }
    }
    export {}
    ```

    6. Create `.env.example`:
    ```bash
    # Supabase — get these from your Supabase project dashboard
    PUBLIC_SUPABASE_URL=https://your-project.supabase.co
    PUBLIC_SUPABASE_PUBLISHABLE_KEY=your-anon-key

    # Private — never expose to browser
    SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

    # App
    ORIGIN=http://localhost:5173
    ```

    7. Create `.env` by copying `.env.example` (leave placeholder values — user fills these in before running auth).

    Do NOT install sveltekit-superforms or Zod in this plan — those are Phase 2+.
  </action>
  <verify>
    Run `npm run check` — should complete with 0 type errors.
    Run `npm run dev -- --port 5173` in background, then check `curl -s http://localhost:5173` returns HTML.
    Stop the dev server.
  </verify>
  <done>
    `npm run check` passes with 0 errors. Dev server starts on port 5173 and returns HTML. `vite.config.ts` has tailwindcss() before sveltekit() in plugins array.
  </done>
</task>

<task type="auto">
  <name>Task 2: Docker container build for adapter-node deployment</name>
  <files>
    Dockerfile
    docker-compose.yml
    .dockerignore
  </files>
  <action>
    Create `Dockerfile` for adapter-node production build:

    ```dockerfile
    FROM node:22-alpine AS builder
    WORKDIR /app
    COPY package*.json ./
    RUN npm ci
    COPY . .
    RUN npm run build

    FROM node:22-alpine AS runner
    WORKDIR /app
    COPY --from=builder /app/build ./build
    COPY --from=builder /app/package*.json ./
    RUN npm ci --omit=dev
    ENV NODE_ENV=production
    EXPOSE 3000
    CMD ["node", "build"]
    ```

    Create `docker-compose.yml` for local container testing:

    ```yaml
    services:
      app:
        build: .
        ports:
          - "3000:3000"
        env_file:
          - .env
        environment:
          - ORIGIN=http://localhost:3000
    ```

    Create `.dockerignore`:
    ```
    node_modules
    .svelte-kit
    build
    .env
    .env.*
    !.env.example
    .git
    .planning
    ```

    Verify the production build works by running:
    ```bash
    npm run build
    ```

    The build should produce a `build/` directory with `index.js` as the entry point. Do NOT start Docker in this task — just verify the build artifact is produced and the Dockerfile is valid (syntax check only via `docker build --no-cache .` if Docker is available, otherwise skip).
  </action>
  <verify>
    Run `npm run build` — should complete without errors and produce `build/index.js`.
    Confirm `Dockerfile` exists and contains the two-stage build (builder + runner stages).
    Confirm `docker-compose.yml` exists with `app` service on port 3000.
  </verify>
  <done>
    `npm run build` exits 0 and `build/index.js` exists. Dockerfile uses two-stage build with node:22-alpine. docker-compose.yml maps port 3000.
  </done>
</task>

</tasks>

<verification>
1. `npm run check` — 0 type errors
2. `npm run dev` — starts without errors, HTML returned at localhost:5173
3. `npm run build` — exits 0, `build/index.js` exists
4. `vite.config.ts` — tailwindcss() comes before sveltekit() in plugins array
5. `src/app.css` — contains exactly `@import "tailwindcss";`
6. `src/routes/+layout.svelte` — imports app.css, uses `$props()` and `{@render children()}`
7. `.env.example` — contains PUBLIC_SUPABASE_URL and PUBLIC_SUPABASE_PUBLISHABLE_KEY
</verification>

<success_criteria>
- SvelteKit 2 + Svelte 5 project exists with TypeScript, ESLint, Prettier
- Tailwind v4 integrated via @tailwindcss/vite (no config file, no PostCSS)
- adapter-node configured for Docker/VPS deployment
- @supabase/supabase-js and @supabase/ssr installed
- Production build succeeds and produces standalone Node server
- Docker infrastructure in place (Dockerfile + docker-compose.yml)
- .env.example documents all required environment variables
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
