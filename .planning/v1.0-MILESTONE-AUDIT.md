---
milestone: v1.0
audited: 2026-02-12T06:00:00Z
status: gaps_found
scores:
  requirements: 38/40
  phases: 5/6 verified (Phase 2 missing VERIFICATION.md)
  integration: 28/31 connections wired
  flows: 5/7 E2E flows complete
gaps:
  requirements:
    - "SRVC-03: Attendance stats for other members — fixed by migration 20260211000005 but Phase 3 VERIFICATION.md still shows gaps_found status"
    - "SITE-08: Public events page — (site) nav links to /events which resolves to (app)/events behind auth; unauthenticated visitors get redirected to login"
  integration:
    - "/auth/logout route does not exist — layout POSTs to /auth/logout but no route handler; users cannot sign out"
    - "Assignment history payload key mismatch — transfer action stores from_unit_name/to_unit_name but profile reads from_unit/to_unit"
  flows:
    - "User logout flow broken — no /auth/logout route"
    - "Public events browsing broken — /events resolves to auth-gated (app)/events"
tech_debt:
  - phase: 01-foundation
    items:
      - "TODO comment in (app)/+layout.server.ts line 13 — obsolete note about user_role hook (cosmetic)"
  - phase: 02-public-site
    items:
      - "No SUMMARY.md or VERIFICATION.md files — Phase 2 executed as single commit without per-plan summaries"
      - "Discord invite URL placeholder in (site)/+layout.svelte footer"
  - phase: 03-soldier-profiles-and-service-records
    items:
      - "$derived(() => {...}) in StatusBadge.svelte — works but $derived.by() is idiomatic Svelte 5"
  - phase: 04-awards-qualifications-roster
    items:
      - "Awards reference table starts empty — admin must seed awards via Supabase dashboard before Command can grant"
---

# Milestone v1.0 — Audit Report

**Milestone:** v1.0 MVP
**Audited:** 2026-02-12
**Status:** GAPS FOUND — 3 critical issues identified

## Phase Verification Summary

| Phase | Status | Score | Notes |
|-------|--------|-------|-------|
| 1. Foundation | PASSED | 8/8 | All auth, RLS, schema verified |
| 2. Public Site | UNVERIFIED | —/— | No VERIFICATION.md; code exists (committed as single feat) |
| 3. Soldier Profiles | PASSED (w/ fix) | 4/5 → 5/5 | RLS gap fixed by migration 20260211000005 |
| 4. Awards, Quals, Roster | PASSED | 5/5 | All truths verified |
| 5. Enlistment Pipeline | PASSED | 5/5 | All truths verified |
| 6. Events, Attendance, Dashboard | PASSED | 5/5 | All truths verified |

## Requirements Coverage

### Satisfied (38/40)

| Requirement | Phase | Status |
|-------------|-------|--------|
| AUTH-01: Discord OAuth login | Phase 1 | SATISFIED |
| AUTH-02: Session persists across refresh | Phase 1 | SATISFIED |
| AUTH-03: 4-tier role hierarchy enforced | Phase 1 | SATISFIED |
| AUTH-04: Roles embedded in JWT via hook | Phase 1 | SATISFIED |
| SITE-01: Landing page with unit identity | Phase 2 | SATISFIED |
| SITE-02: About page with unit history | Phase 2 | SATISFIED |
| SITE-03: Leadership page | Phase 2 | SATISFIED |
| SITE-04: ORBAT displaying troop structure | Phase 2 | SATISFIED |
| SITE-05: Enlistment application form | Phase 2 | SATISFIED |
| SITE-06: Contact page with Discord link | Phase 2 | SATISFIED |
| SITE-07: Rank chart showing SF rank progression | Phase 2 | SATISFIED |
| SITE-09: Partial roster showing names and ranks | Phase 2 | SATISFIED |
| PROF-01: View own profile | Phase 3 | SATISFIED |
| PROF-02: View other members' profiles | Phase 3 | SATISFIED |
| PROF-03: Rank with insignia image | Phase 3 | SATISFIED |
| PROF-04: Current unit assignment | Phase 3 | SATISFIED |
| PROF-05: Member status display | Phase 3 | SATISFIED |
| SRVC-01: Chronological service record | Phase 3 | SATISFIED |
| SRVC-02: Timestamps and performed-by | Phase 3 | SATISFIED |
| SRVC-03: Attendance statistics | Phase 3 | SATISFIED (fixed) |
| SRVC-04: Unit assignment history | Phase 3 | SATISFIED |
| SRVC-05: Combat record | Phase 3 | SATISFIED (fixed) |
| QUAL-01: NCO+ grant qualifications | Phase 4 | SATISFIED |
| QUAL-02: Record course completions | Phase 4 | SATISFIED |
| QUAL-03: Command+ award decorations | Phase 4 | SATISFIED |
| QUAL-04: Awards/quals on profile | Phase 4 | SATISFIED |
| ROST-01: Card grid roster | Phase 4 | SATISFIED |
| ROST-02: Hierarchical tree roster | Phase 4 | SATISFIED |
| ROST-03: Sortable/filterable table roster | Phase 4 | SATISFIED |
| ROST-04: Toggle between roster views | Phase 4 | SATISFIED |
| ENLS-01: Submit enlistment form | Phase 5 | SATISFIED |
| ENLS-02: Review queue for Command+ | Phase 5 | SATISFIED |
| ENLS-03: Advance through states | Phase 5 | SATISFIED |
| ENLS-04: Accept creates soldier profile | Phase 5 | SATISFIED |
| ENLS-05: State transition enforcement | Phase 5 | SATISFIED |
| PERS-01: Promote/demote with service record | Phase 5 | SATISFIED |
| PERS-02: Transfer orders | Phase 5 | SATISFIED |
| PERS-03: Admin status change | Phase 5 | SATISFIED |
| PERS-04: Leadership-only notes | Phase 5 | SATISFIED |
| PERS-05: Assign soldiers to troops | Phase 5 | SATISFIED |
| EVNT-01: Create events (operations, training, FTX) | Phase 6 | SATISFIED |
| EVNT-02: Edit and cancel events | Phase 6 | SATISFIED |
| EVNT-03: Record per-member attendance | Phase 6 | SATISFIED |
| EVNT-04: View upcoming events list | Phase 6 | SATISFIED |
| EVNT-05: Attendance links to service record | Phase 6 | SATISFIED |
| ADMN-01: Dashboard with key metrics | Phase 6 | SATISFIED |
| ADMN-02: Recent personnel actions | Phase 6 | SATISFIED |
| ADMN-03: Unit readiness overview | Phase 6 | SATISFIED |

### Gaps (2/40)

| Requirement | Phase | Status | Issue |
|-------------|-------|--------|-------|
| SITE-08: View upcoming events | Phase 2 | BROKEN | Public nav links to `/events` which resolves to auth-gated `(app)/events`; unauthenticated visitors redirected to login |
| AUTH (logout) | Phase 1 | MISSING | No `/auth/logout` route exists; users cannot sign out |

Note: Auth logout was not an explicit numbered requirement but is an essential part of AUTH-01 (Discord OAuth login lifecycle). The session can be created but not destroyed.

## Cross-Phase Integration

### Wired (28 connections verified)

All major data flows between phases are correctly connected:
- Auth → all gated routes via getClaims() + hasRole()
- Enlistment form → review queue → soldier creation
- Awards/qualifications → service_records dual-write → profile timeline
- Personnel actions → service_records dual-write → profile timeline
- Attendance recording → profile stats and combat record
- Dashboard → all metrics tables via Promise.all

### Broken (3 connections)

1. **`/auth/logout` — Critical**
   - `(app)/+layout.svelte` line 31: `<form method="POST" action="/auth/logout">`
   - No route handler at `src/routes/auth/logout/`
   - Users cannot sign out; clicking Logout returns 404

2. **Assignment history payload keys — Medium**
   - Writer (`+page.server.ts` line 450): stores `from_unit_name`, `to_unit_name`
   - Reader (`+page.svelte` lines 528-530): reads `from_unit`, `to_unit`
   - Assignment history always shows `— → —`

3. **Public events nav — Medium**
   - `(site)/+layout.svelte` line 10: links to `/events`
   - No `(site)/events/` page exists
   - Resolves to `(app)/events` behind auth → redirect to login

## E2E Flows

| Flow | Status | Notes |
|------|--------|-------|
| Enlistment → Soldier lifecycle | COMPLETE | Full pipeline: submit → review → accept → soldier created |
| Event → Attendance → Profile | COMPLETE | Create event → record attendance → profile stats update |
| Personnel action → Service record → Profile | COMPLETE | All 4 actions (promote, transfer, status, note) wired |
| Award/Qualification → Service record → Profile | COMPLETE | Dual-write pattern verified for both |
| Auth → Navigation | PARTIAL | Login/JWT/role extraction works; logout broken |
| Dashboard aggregation | COMPLETE | All 7 parallel queries wired to display |
| Public events browsing | BROKEN | Nav link leads to auth redirect |

## Tech Debt Summary

| Phase | Item | Severity |
|-------|------|----------|
| Phase 1 | Obsolete TODO comment in layout.server.ts | Info |
| Phase 2 | No SUMMARY.md or VERIFICATION.md files | Info |
| Phase 2 | Discord invite URL placeholder in footer | Info |
| Phase 3 | $derived() vs $derived.by() in StatusBadge | Info |
| Phase 4 | Awards table starts empty (seed needed) | Info |

Total: 5 items across 4 phases — all informational, no blockers.

---

_Audited: 2026-02-12_
_Auditor: Claude (gsd-milestone-audit)_
